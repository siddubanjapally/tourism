// Generated by CoffeeScript 1.6.3
(function() {
  var app, districtModel, onError, toArray;

  app = this.app || {};

  app.dbinit();

  document.addEventListener("deviceready", (function() {
    return app.dbinit();
  }), false);

  onError = function(tx, err) {
    return console.log(err.message);
  };

  toArray = function(result) {
    var i, len, _i, _results;
    len = result.rows.length;
    _results = [];
    for (i = _i = 0; 0 <= len ? _i < len : _i > len; i = 0 <= len ? ++_i : --_i) {
      _results.push(result.rows.item(i));
    }
    return _results;
  };

  districtModel = kendo.observable({
    placeName: '',
    districtDS: new kendo.data.DataSource({
      transport: {
        read: function(options) {
          return app.db.transaction(function(tx) {
            return tx.executeSql("select DistId,DistName,DistImgpath from district", [], (function(tx, result) {
              return options.success(toArray(result));
            }), onError);
          });
        }
      }
    }),
    districtPlacesDS: new kendo.data.DataSource({
      transport: {
        read: function(options) {
          return app.db.transaction(function(tx) {
            return tx.executeSql('select * from places', [], (function(tx, result) {
              return options.success(toArray(result));
            }), onError);
          });
        }
      }
    }),
    galleryDS: new kendo.data.DataSource({
      transport: {
        read: function(options) {
          return app.db.transaction(function(tx) {
            return tx.executeSql('select * from gallery', [], (function(tx, result) {
              return options.success(toArray(result));
            }), onError);
          });
        }
      }
    }),
    hotelsDS: new kendo.data.DataSource({
      transport: {
        read: function(options) {
          return app.db.transaction(function(tx) {
            return tx.executeSql('select * from hotels', [], (function(tx, result) {
              return options.success(toArray(result));
            }), onError);
          });
        }
      }
    })
  });

  this.placesClick = function(e) {
    var id;
    id = e.dataItem.PlaceName;
    return districtModel.set('placeName', id);
  };

  this.placesDatashow = function(e) {
    var id;
    id = e.view.params['id'];
    return districtModel.districtPlacesDS.filter({
      field: "DistName",
      operator: "startswith",
      value: id
    });
  };

  this.placeDescDatashow = function(e) {
    districtModel.districtPlacesDS.filter({
      field: "PlaceName",
      operator: "startswith",
      value: districtModel.placeName
    });
    return $("#panelbar").kendoPanelBar({
      expandMode: "single"
    });
  };

  this.galleryDatashow = function(e) {
    return districtModel.galleryDS.filter({
      field: "PlaceName",
      operator: "startswith",
      value: districtModel.placeName
    });
  };

  this.hotelsDatashow = function(e) {
    return districtModel.hotelsDS.filter({
      field: "PlaceName",
      operator: "startswith",
      value: districtModel.placeName
    });
  };

  kendo.bind(document.body, districtModel);

}).call(this);
